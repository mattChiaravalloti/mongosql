# Autogenerated Tests

This crate contains the build script necessary for autogenerated tests.

The `tests` directory is scanned for supported test types. Currently, the supported
tests are: e2e, error, index_usage, spec/query, and schema_derivation. Each
file is parsed in the build script to:
1. determine if a test should be generated
2. create the tests

Autogenerated tests may contain cases that are irrelevant for a particular
test; this is fine because it's generated code and *all* tests eventually
use all contents.

## Running the tests

You can run specific test types with feature flags.

- E2E tests: `cargo test --package e2e-tests --features e2e`
- Error tests: `cargo test --package e2e-tests --features error`
- Index tests: `cargo test --package e2e-tests --features index`
- Query tests: `cargo test --package e2e-tests --features query`
- Schema Derivation tests: `cargo test --package e2e-tests --features schema_derivation`
- *ALL* tests: `cargo test --package e2e-tests --features all`

## Adding new tests

The easiest way to add new tests is to append to a file, or create a new file
in the tests directory following the structure of a similar file. This will
automatically be built into a new test file with test cases. Don't forget to
create or update a corresponding testdata file if new namespace information
such as documents, schema, view pipeline, and/or indexes are needed.

## Updating sql-engines-common-test-infra

This test generation build script depends on the
[sql-engines-common-test-infra](https://github.com/mongodb/sql-engines-common-test-infra)
repository's `test-generator` crate. If you need to use updated features from that
crate, run `cargo update test-generator` to update the `Cargo.lock` file to use the
latest commit. Note you likely need to set `CARGO_NET_GIT_FETCH_WITH_CLI=true` for this
to work.
